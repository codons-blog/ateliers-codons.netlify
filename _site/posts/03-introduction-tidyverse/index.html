<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sandra Angers-Blondin">
<meta name="author" content="Jonathan Kitt (adaptation)">
<meta name="dcterms.date" content="2022-10-24">

<title>Ateliers codons - Introduction au Tidyverse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Ateliers codons</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/codons-blog/"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Introduction au Tidyverse</h1>
            <p class="subtitle lead">Utiliser le Tidyverse pour manipuler des données</p>
                                <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">RStudio</div>
                <div class="quarto-category">Tidyverse</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Authors</div>
      <div class="quarto-title-meta-contents">
               <p>Sandra Angers-Blondin </p>
               <p>Jonathan Kitt (adaptation) </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 24, 2022</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Sommaire</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#quest-ce-que-le-tidyverse" id="toc-quest-ce-que-le-tidyverse" class="nav-link" data-scroll-target="#quest-ce-que-le-tidyverse">Qu’est-ce que le Tidyverse ?</a></li>
  <li><a href="#pré-requis" id="toc-pré-requis" class="nav-link" data-scroll-target="#pré-requis">Pré-requis</a></li>
  </ul></li>
  <li><a href="#premiers-pas-dans-le-tidyverse" id="toc-premiers-pas-dans-le-tidyverse" class="nav-link" data-scroll-target="#premiers-pas-dans-le-tidyverse">Premiers pas dans le Tidyverse</a>
  <ul class="collapse">
  <li><a href="#importer-les-données" id="toc-importer-les-données" class="nav-link" data-scroll-target="#importer-les-données">Importer les données</a></li>
  <li><a href="#explorer-les-données" id="toc-explorer-les-données" class="nav-link" data-scroll-target="#explorer-les-données">Explorer les données</a></li>
  <li><a href="#créer-une-copie-de-travail" id="toc-créer-une-copie-de-travail" class="nav-link" data-scroll-target="#créer-une-copie-de-travail">Créer une copie de travail</a></li>
  <li><a href="#renommer-des-colonnes" id="toc-renommer-des-colonnes" class="nav-link" data-scroll-target="#renommer-des-colonnes">Renommer des colonnes</a></li>
  <li><a href="#sélectionner-des-colonnes" id="toc-sélectionner-des-colonnes" class="nav-link" data-scroll-target="#sélectionner-des-colonnes">Sélectionner des colonnes</a></li>
  <li><a href="#filtrer-des-données" id="toc-filtrer-des-données" class="nav-link" data-scroll-target="#filtrer-des-données">Filtrer des données</a></li>
  <li><a href="#trier-des-données" id="toc-trier-des-données" class="nav-link" data-scroll-target="#trier-des-données">Trier des données</a></li>
  <li><a href="#créer-ou-modifier-des-colonnes" id="toc-créer-ou-modifier-des-colonnes" class="nav-link" data-scroll-target="#créer-ou-modifier-des-colonnes">Créer ou modifier des colonnes</a></li>
  <li><a href="#effectuer-des-comptages" id="toc-effectuer-des-comptages" class="nav-link" data-scroll-target="#effectuer-des-comptages">Effectuer des comptages</a></li>
  <li><a href="#agréger-des-lignes" id="toc-agréger-des-lignes" class="nav-link" data-scroll-target="#agréger-des-lignes">Agréger des lignes</a></li>
  <li><a href="#regrouper-les-données" id="toc-regrouper-les-données" class="nav-link" data-scroll-target="#regrouper-les-données">Regrouper les données</a></li>
  </ul></li>
  <li><a href="#ceci-nest-pas-un-pipe" id="toc-ceci-nest-pas-un-pipe" class="nav-link" data-scroll-target="#ceci-nest-pas-un-pipe">“Ceci n’est pas un pipe”</a></li>
  <li><a href="#manipuler-des-chaînes-de-caractères" id="toc-manipuler-des-chaînes-de-caractères" class="nav-link" data-scroll-target="#manipuler-des-chaînes-de-caractères">Manipuler des chaînes de caractères</a></li>
  <li><a href="#joindre-des-tableaux" id="toc-joindre-des-tableaux" class="nav-link" data-scroll-target="#joindre-des-tableaux">Joindre des tableaux</a></li>
  <li><a href="#transformer-des-tableaux" id="toc-transformer-des-tableaux" class="nav-link" data-scroll-target="#transformer-des-tableaux">Transformer des tableaux</a></li>
  <li><a href="#manipuler-des-facteurs" id="toc-manipuler-des-facteurs" class="nav-link" data-scroll-target="#manipuler-des-facteurs">Manipuler des facteurs</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p><em>Ce tutoriel est adapté de <a href="https://ourcodingclub.github.io/tutorials/data-manip-intro/index.html">Basic data manipulation</a> et <a href="https://ourcodingclub.github.io/tutorials/data-manip-efficient/">Efficient data manipulation</a> du site <a href="https://ourcodingclub.github.io/">Our Coding Club</a>.</em></p>
<p><br></p>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<section id="quest-ce-que-le-tidyverse" class="level2">
<h2 class="anchored" data-anchor-id="quest-ce-que-le-tidyverse">Qu’est-ce que le Tidyverse ?</h2>
<p>Le <a href="https://www.tidyverse.org/">Tidyverse</a> est un ensemble de packages proposant de multiples fonctions utiles à l’ensemble des étapes d’une analyse :</p>
<table class="table">
<tbody>
<tr class="odd">
<td style="text-align: left;"><a href="https://readr.tidyverse.org/">readr</a></td>
<td style="text-align: left;">importer et exporter les données</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="https://tibble.tidyverse.org/">tibble</a></td>
<td style="text-align: left;">format de tableau propre au tidyverse</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="https://dplyr.tidyverse.org/">dplyr</a></td>
<td style="text-align: left;">manipuler les données</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="https://tidyr.tidyverse.org/">tidyr</a></td>
<td style="text-align: left;">transformer des tableaux</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="https://stringr.tidyverse.org/">stringr</a></td>
<td style="text-align: left;">manipuler des chaînes de caractères</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="https://forcats.tidyverse.org/">forcats</a></td>
<td style="text-align: left;">manipuler des variables catégorielles</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="https://ggplot2.tidyverse.org/">ggplot2</a></td>
<td style="text-align: left;">représenter les données</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="https://purrr.tidyverse.org/">purrr</a></td>
<td style="text-align: left;">programmation fonctionnelle</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="https://lubridate.tidyverse.org/">lubridate</a></td>
<td style="text-align: left;">manipuler des dates</td>
</tr>
</tbody>
</table>
<p><br></p>
</section>
<section id="pré-requis" class="level2">
<h2 class="anchored" data-anchor-id="pré-requis">Pré-requis</h2>
<p>Si vous n’avez pas suivi les autres tutoriels, vous pouvez <a href="https://ateliers-codons.netlify.app/posts/02-premiers-pas-avec-r/#créer-un-projet">créer un projet RStudio</a> et <a href="https://ateliers-codons.netlify.app/posts/02-premiers-pas-avec-r/#créer-une-arborescence">une arborescence</a>.</p>
<p>Pour utiliser le Tidyverse, vous pouvez soit installer et charger séparément les packages dont vous aurez besoin, soit installer et charger directement la suite complète :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Installer et charger les packages readr et dplyr</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"readr"</span>, <span class="st">"dplyr"</span>))</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Installer et charger la suite Tidyverse</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Les conflits
</div>
</div>
<div class="callout-body-container callout-body">
<p>Lorsque vous exécutez la fonction <code>library(tidyverse)</code>, le message suivant s’affiche dans la console :</p>
<p><img src="img/tidyverse_intro_01.png" class="img-fluid"></p>
<p>R vous indique :</p>
<ul>
<li>le nom et la version des packages individuels (<em>Attaching packages</em>)<br>
</li>
<li>les fonctions portant des noms identiques existant dans d’autres packages (<em>Conflicts</em>)</li>
</ul>
<p>Il existe par exemple une fonction <code>filter()</code> dans le package <code>stats</code>. Si vous souhaitez utiliser cette dernière fonction plutôt que celle proposée dans le package <code>dplyr</code>, il vous foudra préciser le package en question : <code>stats::filter()</code>.</p>
</div>
</div>
<p><br></p>
</section>
</section>
<section id="premiers-pas-dans-le-tidyverse" class="level1">
<h1>Premiers pas dans le Tidyverse</h1>
<p>Les fonctions proposées dans les différents packages de la suite Tidyverse sont - en règle générale - nommées d’après les actions qu’elles accomplissent, ce qui rend leur mémorisation plus simple et leur utilisation plus intuitive.</p>
<section id="importer-les-données" class="level2">
<h2 class="anchored" data-anchor-id="importer-les-données">Importer les données</h2>
<p>Nous allons utiliser le même jeu de données que dans les tutoriels précédents (vous pouvez le télécharger <a href="https://raw.githubusercontent.com/codons-blog/ateliers-codons.netlify/main/raw/pingouins.csv">ici</a> et le sauvegarder dans votre dossier <code>raw/</code>).</p>
<p>Pour importer les données, nous utilisons la fonction <code>read_csv()</code>, à ne pas comprendre avec la fonction <code>read.csv()</code> utilisée précédemment.</p>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>pingouins <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">"raw/pingouins.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vous pouvez voir dans la console des informations concernant vos données :<br>
- les <em>dimensions</em> du tableau<br>
- le <em>séparateur</em> de colonnes<br>
- les <em>types</em> et les <em>noms</em> des variables</p>
<p><br></p>
<p>Tapez <code>pingouins</code> dans la console et appuyez sur <code>Entrée</code> : vos données s’affichent et vous pouvez voir qu’il s’agit d’un <em>tibble</em>, qui présente quelques particularités par rapport à un tableau “classique” :</p>
<ul>
<li>les dimensions du <em>tibble</em> sont précisées<br>
</li>
<li>les <em>types</em> des variables sont indiquées sous les noms des colonnes<br>
</li>
<li>seules les <em>dix premières lignes</em> sont affichées<br>
</li>
<li>le nombre de colonnes affichées dépend de la largeur de l’écran<br>
</li>
<li>les noms de colonnes sont raccourcis si nécessaire<br>
</li>
<li>les données manquantes <em>NA</em> sont mises en évidence</li>
</ul>
<p>Pour bien voir la différence entre un <code>tibble</code> et un <code>data.frame</code>, comparez les deux commandes suivantes :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>pingouins</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(pingouins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exporter des données
</div>
</div>
<div class="callout-body-container callout-body">
<p>Pour exporter des données au format <em>csv</em>, utiliser la fonction <code>write_csv()</code></p>
</div>
</div>
<p><br></p>
</section>
<section id="explorer-les-données" class="level2">
<h2 class="anchored" data-anchor-id="explorer-les-données">Explorer les données</h2>
<p>Plusieurs fonctions incluses dans R permettent d’explorer rapidement des données pour s’assurer qu’elles ont été correctement importées :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher les premieres lignes</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pingouins)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher les dernieres lignes</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(pingouins)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher la structure des donnees</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(pingouins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La fonction <code>glimpse()</code> (du package <code>readr</code>) retourne sensiblement les mêmes informations que la fonction <code>str()</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(pingouins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
</section>
<section id="créer-une-copie-de-travail" class="level2">
<h2 class="anchored" data-anchor-id="créer-une-copie-de-travail">Créer une copie de travail</h2>
<p>La première chose à faire avant de manipuler, modifier et transformer nos données est de créer une copie de travail : cela nous permettra, en cas d’erreur, de repartir des données d’origines.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>pingouins_tmp <span class="ot">&lt;-</span> pingouins</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
</section>
<section id="renommer-des-colonnes" class="level2">
<h2 class="anchored" data-anchor-id="renommer-des-colonnes">Renommer des colonnes</h2>
<p>Commençons par renommer des colonnes afin de respecter les conventions d’écriture :</p>
<ul>
<li><em>snake_case</em> : caractères minuscules, mots séparés par des <code>_</code><br>
</li>
<li><em>camelCase</em> : aucune séparation entre les mots, majuscule pour débuter un mot</li>
</ul>
<p>La fonction <code>rename</code> s’utilise de la façon suivante : <code>rename(data, nouveau nom = ancien nom)</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">rename</span>(pingouins_tmp, <span class="at">ile =</span> Ile)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous pourrions procéder de la même façon pour plusieurs colonnes à la fois :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">rename</span>(pingouins_tmp, <span class="at">espece =</span> Espece, <span class="at">ile =</span> Ile)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Le package <a href="https://cran.r-project.org/web/packages/janitor/vignettes/janitor.html"><code>janitor</code></a> est dédié au nettoyage d’un tableau (noms de colonnes, suppression des doublons, …). Utilisons la fonction <code>clean_names()</code> de ce package :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>janitor<span class="sc">::</span><span class="fu">clean_names</span>(pingouins_tmp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Assignons ces noms de colonnes nettoyés à notre copie de travail :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>pingouins_tmp <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>(pingouins_tmp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Assurons-nous que les noms de colonnes ont bien été modifiés :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pingouins_tmp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Explorer les arguments d’une fonction
</div>
</div>
<div class="callout-body-container callout-body">
<p>Pour afficher l’aide de la fonction <code>clean_names</code>, tapez <code>?clean_names</code> (ou <code>?janitor::clean_names</code>) dans la console. Vous trouverez dans l’aide toutes les informations concernant une fonction. Dans notre cas, nous pourrions utiliser différentes conventions d’écriture pour nos noms de colonnes : <code>clean_names(pingouins_tmp, case = "lower_camel")</code> par exemple.</p>
</div>
</div>
<p><br></p>
</section>
<section id="sélectionner-des-colonnes" class="level2">
<h2 class="anchored" data-anchor-id="sélectionner-des-colonnes">Sélectionner des colonnes</h2>
<p>La fonction <code>select()</code> permet de sélectionner les colonnes d’un tableau. Nous allons sélectionner les colonnes <em>espece</em>, <em>ile</em>, <em>longueur_bec_mm</em>, <em>hauteur_bec_mm</em>, <em>longueur_aile_mm</em> et <em>masse_corporelle_g</em>. Nous pouvons procéder de plusieurs façons :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Indiquer toutes les colonnes</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(pingouins_tmp, espece, ile, longueur_bec_mm, hauteur_bec_mm,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>              longueur_aile_mm, masse_corporelle_g)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Indiquer les suites de colonnes</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(pingouins_tmp, espece<span class="sc">:</span>ile, longueur_bec_mm<span class="sc">:</span>masse_corporelle_g)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Supprimer des colonnes</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(pingouins_tmp, <span class="sc">-</span><span class="fu">c</span>(etude_numero, echantillon_numero, id_individu))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>D’autres fonctions du package <code>dplyr</code> permettent de sélectionner des colonnes :</p>
<ul>
<li><code>contains()</code> : sélectionner les noms de colonnes qui contiennent un motif<br>
</li>
<li><code>starts_width()</code> : sélectionner les noms de colonnes qui commencent par un motif<br>
</li>
<li><code>ends_width()</code> : sélectionner les noms de colonnes qui se terminent par un motif</li>
</ul>
<p>Dans notre cas, nous pouvons sélectionner les colonnes <em>espece</em> et <em>ile</em>, puis les colonnes dont le nom se termine par <em>mm</em> ou par <em>g</em> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Utiliser la fonction ends_with()</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(pingouins_tmp, espece, ile, dplyr<span class="sc">::</span><span class="fu">ends_with</span>(<span class="fu">c</span>(<span class="st">"mm"</span>, <span class="st">"g"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Assignons cette sélection de colonnes à notre objet :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>pingouins_tmp <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(pingouins_tmp, espece, ile, dplyr<span class="sc">::</span><span class="fu">ends_with</span>(<span class="fu">c</span>(<span class="st">"mm"</span>, <span class="st">"g"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Renommer et ré-ordonner des colonnes avec <code>select()</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Nous pouvons utiliser la fonction <code>select()</code> pour renommer des colonnes :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(pingouins_tmp, espece<span class="sc">:</span>longueur_aile_mm, <span class="at">masse =</span> masse_corporelle_g)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Mais aussi pour modifier l’ordre des colonnes :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(pingouins_tmp, espece<span class="sc">:</span>ile, masse_corporelle_g, longueur_bec_mm<span class="sc">:</span>longueur_aile_mm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Enfin, si nous n’avons que quelques colonnes à déplacer, la fonction <code>everything()</code> permet de sélectionner le reste du tableau !</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(pingouins_tmp, ile, dplyr<span class="sc">::</span><span class="fu">everything</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="filtrer-des-données" class="level2">
<h2 class="anchored" data-anchor-id="filtrer-des-données">Filtrer des données</h2>
<p>La fonction <code>filter()</code> permet de filtrer les données à l’aide d’opérateurs logiques :</p>
<table class="table">
<tbody>
<tr class="odd">
<td><code>==</code></td>
<td>strictement égal à</td>
</tr>
<tr class="even">
<td><code>&lt;=</code></td>
<td>inférieur ou égal à</td>
</tr>
<tr class="odd">
<td><code>&lt;</code></td>
<td>inférieur à</td>
</tr>
<tr class="even">
<td><code>&gt;=</code></td>
<td>supérieur ou égal à</td>
</tr>
<tr class="odd">
<td><code>&gt;</code></td>
<td>supérieur à</td>
</tr>
<tr class="even">
<td><code>!=</code></td>
<td>différent de</td>
</tr>
<tr class="odd">
<td><code>%in%</code></td>
<td>appartient à</td>
</tr>
<tr class="even">
<td><code>&amp;</code></td>
<td>et</td>
</tr>
<tr class="odd">
<td><code>|</code></td>
<td>ou</td>
</tr>
<tr class="even">
<td><code>!</code></td>
<td>négation</td>
</tr>
</tbody>
</table>
<p>Voici deux exemples :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Individus vivant sur l'ile Biscoe pesant au moins 5 kgs</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(pingouins_tmp, ile <span class="sc">==</span> <span class="st">"Biscoe"</span>, masse_corporelle_g <span class="sc">&gt;=</span> <span class="dv">5000</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Individus vivant sur les iles Biscoe ou Torgersen</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(pingouins_tmp, ile <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Biscoe"</span>, <span class="st">"Torgersen"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>La fonction <code>between()</code> permet de garder les valeurs numériques entre deux bornes :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Individus pesant entre 3 kgs et 3,5 kgs</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(pingouins_tmp, dplyr<span class="sc">::</span><span class="fu">between</span>(masse_corporelle_g, <span class="dv">3000</span>, <span class="dv">3250</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Notre jeu de données contient des données manquantes <code>NA</code>. Il existe plusieurs manières de supprimer ces données manquantes :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Garder les lignes pour lesquelles la variable longueur_bec_mm ne contient pas de NA</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(pingouins_tmp, <span class="sc">!</span><span class="fu">is.na</span>(longueur_bec_mm))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Supprimer les lignes pour lesquelles la variable longueur_bec_mm contient au moins un NA</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>tidyr<span class="sc">::</span><span class="fu">drop_na</span>(pingouins_tmp, longueur_bec_mm)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Supprimer les lignes contenant des NAs, quelque soit la variable</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>tidyr<span class="sc">::</span><span class="fu">drop_na</span>(pingouins_tmp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Extraire les lignes uniques
</div>
</div>
<div class="callout-body-container callout-body">
<p>La fonction <code>distinct()</code> permet d’extraire les observations uniques présentes dans une colonne ou une combinaison de colonnes :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">distinct</span>(pingouins_tmp, ile, espece)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="trier-des-données" class="level2">
<h2 class="anchored" data-anchor-id="trier-des-données">Trier des données</h2>
<p>La fonction <code>arrange()</code> permet de trier des données. Par défaut, le tri s’effectue par ordre croissant. Pour trier des données par ordre décroissant, il faut ajouter la fonction <code>desc()</code> ou utiliser un <em>moins</em> <code>-</code> devant le nom de la colonne :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Trier les données par ordre croisant de longueur de bec</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">arrange</span>(pingouins_tmp, longueur_bec_mm)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Trier les données par ordre décroissant de masse corporelle</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">arrange</span>(pingouins_tmp, dplyr<span class="sc">::</span><span class="fu">desc</span>(masse_corporelle_g))</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">arrange</span>(pingouins_tmp, <span class="sc">-</span>masse_corporelle_g)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Il est possible de trier sur plusieurs colonnes : nous pouvons trier les individus par ordre décroissant de hauteur de bec puis par ordre décroissant de longueur de bec. Cela peut être utile pour départager des individus “ex-aequo” pour une variable :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">arrange</span>(pingouins_tmp, dplyr<span class="sc">::</span><span class="fu">desc</span>(hauteur_bec_mm), dplyr<span class="sc">::</span><span class="fu">desc</span>(longueur_bec_mm))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
</section>
<section id="créer-ou-modifier-des-colonnes" class="level2">
<h2 class="anchored" data-anchor-id="créer-ou-modifier-des-colonnes">Créer ou modifier des colonnes</h2>
<p>La fonction <code>mutate()</code> permet de créer une nouvelle colonne. Nous pouvons par exemple ajouter une colonne <em>ratio_bec</em> dans laquelle nous allons calculer le rapport entre la longueur du bec et sa hauteur :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">mutate</span>(pingouins_tmp, <span class="at">ratio_bec =</span> longueur_bec_mm <span class="sc">/</span> hauteur_bec_mm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous pouvons également modifier le contenu d’une colonne, par exemple en ajoutant le suffixe <em>island</em> au contenu de la colonne <em>ile</em> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">mutate</span>(pingouins_tmp, <span class="at">ile =</span> <span class="fu">paste0</span>(ile, <span class="st">" island"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La fonction <code>transmute()</code> permet quant à elle de créer une nouvelle colonne tout en supprimant les colonnes pré-existantes :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">transmute</span>(pingouins_tmp, <span class="at">masse_kgs =</span> masse_corporelle_g <span class="sc">/</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
</section>
<section id="effectuer-des-comptages" class="level2">
<h2 class="anchored" data-anchor-id="effectuer-des-comptages">Effectuer des comptages</h2>
<p>La fonction <code>count()</code> permet d’effectuer des comptages sur les variables.</p>
<p>Comptons le nombre d’individus par espèce :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">count</span>(pingouins_tmp, espece)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>L’argument <code>sort = TRUE</code> permet d’afficher le résultat par ordre décroissant :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">count</span>(pingouins_tmp, espece, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Nous pouvons également compter les individus par île et par espèce :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">count</span>(pingouins_tmp, ile, espece, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Dans le dernier cas, seuls les combinaisons de variables pour lesquelles il existe des combinaisons sont affichées. Il peut être intéressant d’afficher tous les cas de figure, à l’aide de la fonction <code>complete()</code>. Il faut préciser les variables à utiliser pour compléter les combinaisons :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>nb_ind_ile_espece <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">count</span>(pingouins_tmp, ile, espece, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>tidyr<span class="sc">::</span><span class="fu">complete</span>(nb_ind_ile_espece, ile, espece)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La variable <code>n</code> prend comme valeur <code>NA</code> lorsque la combinaison n’est pas présente dans le tableau. Nous pouvons remplacer ces <code>NA</code> par des zéros :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>tidyr<span class="sc">::</span><span class="fu">complete</span>(nb_ind_ile_espece, ile, espece, <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">n =</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
</section>
<section id="agréger-des-lignes" class="level2">
<h2 class="anchored" data-anchor-id="agréger-des-lignes">Agréger des lignes</h2>
<p>La fonction <code>summarise()</code> permet d’agréger des lignes en effectuant une opération.</p>
<p>Calculons la longueur moyenne du bec pour l’ensemble des individus, sans oublier l’argument <code>na.rm = TRUE</code> pour supprimer les données manquantes lors du calcul. Si nous avions assigné à l’objet <code>pingouins_tmp</code> les données après avoir retiré les lignes contenant des données manquantes, nous pourrions nous passer de cet argument. Dans le doute, mieux vaut ajouter cet argument :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">summarise</span>(pingouins_tmp,</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">longueur_bec_mm_moy =</span> <span class="fu">mean</span>(longueur_bec_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cette fonction peut également s’utiliser sur plusieurs variables :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">summarise</span>(pingouins_tmp,</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">longueur_bec_mm_moy =</span> <span class="fu">mean</span>(longueur_bec_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">hauteur_bec_mm_moy =</span> <span class="fu">mean</span>(hauteur_bec_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
</section>
<section id="regrouper-les-données" class="level2">
<h2 class="anchored" data-anchor-id="regrouper-les-données">Regrouper les données</h2>
<p>La fonction <code>group_by()</code>, utilisée en combinaison avec la fonction <code>summarise()</code>, permet de regrouper les données pour effectuer des calculs par groupe.</p>
<p>Calculons la longueur moyenne du bec par espece :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">summarise</span>(dplyr<span class="sc">::</span><span class="fu">group_by</span>(pingouins_tmp, espece),</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">longueur_bec_mm_moy =</span> <span class="fu">mean</span>(longueur_bec_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cette fonction permet de définir des sous-groupes. Calculons la longueur moyenne du bec par île et par espèce :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">summarise</span>(dplyr<span class="sc">::</span><span class="fu">group_by</span>(pingouins_tmp, ile, espece),</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">longueur_bec_mm_moy =</span> <span class="fu">mean</span>(longueur_bec_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Dégrouper les données
</div>
</div>
<div class="callout-body-container callout-body">
<p>La fonction <code>ungroup()</code> permet de dégrouper les données</p>
</div>
</div>
<p><br></p>
<div class="callout-important callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercice 1 - énoncé
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importer le fichier gapminder.csv</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Explorer les donnees </span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compter le nombre de pays par continent</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Creer une copie de travail</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Nettoyer les noms de colonnes</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Deplacer la colonne "continent" en premiere position</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajouter une colonne contenant le PIB global</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrer les donnees pour 2007 et trier par ordre decroissant de PIB global</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculer la mediane du PIB par habitant en 2007 par continent</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout-important callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercice 1 - solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importer le fichier gapminder.csv</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>gapminder <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"raw/gapminder.csv"</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Explorer les donnees </span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(gapminder)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Creer une copie de travail</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>gapminder_tmp <span class="ot">&lt;-</span> gapminder</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Nettoyer les noms de colonnes</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>gapminder_tmp <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>(gapminder_tmp)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Deplacer la colonne "continent" en premiere position</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>gapminder_tmp <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(gapminder_tmp, continent, dplyr<span class="sc">::</span><span class="fu">everything</span>())</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajouter une colonne contenant le PIB global</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>gapminder_tmp <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(gapminder_tmp, </span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>                               <span class="at">gdp_global =</span> pop <span class="sc">*</span> gdp_percap)</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrer les donnees pour 2007 et trier par ordre decroissant de PIB global</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>gapminder_2007 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(gapminder_tmp, year <span class="sc">==</span> <span class="dv">2007</span>)</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>gapminder_2007_tri <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">arrange</span>(gapminder_2007, <span class="sc">-</span>gdp_global)</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculer la mediane du PIB par habitant en 2007 par continent</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(dplyr<span class="sc">::</span><span class="fu">group_by</span>(gapminder_2007, continent),</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">median_gdp_global =</span> <span class="fu">median</span>(gdp_percap, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p><br></p>
</section>
</section>
<section id="ceci-nest-pas-un-pipe" class="level1">
<h1>“Ceci n’est pas un pipe”</h1>
<p>Jusqu’à présent, nous avons utilisé les fonctions une par une, en créant si nécessaire des objets intermédiaires. Cette façon de procéder peut rapidement encombrer notre environnement.</p>
<p>Il existe une façon d’enchaîner les fonctions les unes à la suite des autres, qui présente plusieurs avantages :</p>
<ul>
<li>rendre le code plus clair et lisible<br>
</li>
<li>réduire le nombre d’objets intermédiaires nécessaires à l’analyse<br>
</li>
<li>permettre d’utiliser l’auto-complétion (à l’aide de la touche <code>Tab</code>)</li>
</ul>
<p>L’enchaînement des fonctions s’effectue à l’aide de ce que l’on appelle un <em>pipe</em>, disponible dans le package <a href="https://magrittr.tidyverse.org/"><code>magrittr</code></a>.</p>
<p><img src="img/pipe_logo.png" class="img-fluid" style="width:20.0%"></p>
<p>Un pipe s’écrit <code>%&gt;%</code> et se place à la fin d’une ligne :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>pingouins <span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Raccourci clavier : le pipe
</div>
</div>
<div class="callout-body-container callout-body">
<p>Pour insérer un pipe, utilisez la combinaison <em>Ctrl + Shift + M</em></p>
</div>
</div>
<p><br></p>
<p>Nous pouvons ainsi enchaîner les fonctions sans avoir à créer des objets intermédiaires :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>pingouins <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">drop_na</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Le pipe “natif” <code>|&gt;</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Les versions les plus récentes de R (à partir de 4.1) proposent un pipe “natif”, qui ne nécessite pas de faire appel au package <code>magrittr</code>. Ce pipe s’écrit sous la forme <code>|&gt;</code>.</p>
<p>Pour utiliser le pipe <code>|&gt;</code>, cliquez sur <em>Tools</em> &gt; <em>Global Options</em>. Dans le menu <em>Code</em> et l’onglet <em>Editing</em>,cochez la case <em>Use native pipe operator</em>.</p>
<p><img src="img/tidyverse_intro_02.png" class="img-fluid"></p>
<p>Le raccourci clavier <strong>Ctrl + Shift + M</strong> insérera alors un pipe <code>|&gt;</code>.</p>
</div>
</div>
<p><br></p>
<div class="callout-important callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercice 2 - énoncé
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>Compter le nombre de pays par continent</p></li>
<li><p>Effectuer les opérations suivantes à l’aide d’un pipe et les assigner dans un objet <code>gapminder_tmp</code></p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creer une copie de travail</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Nettoyer les noms de colonnes</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Deplacer la colonne "continent" en premiere position</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajouter une colonne contenant le PIB global</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout-important callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercice 2 - solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Compter le nombre de pays par continent</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>(Continent, Country) <span class="sc">%&gt;%</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(Continent, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Nettoyer les donnnes</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>gapminder_tmp <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(continent, dplyr<span class="sc">::</span><span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">gdp_global =</span> pop <span class="sc">*</span> gdp_percap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="manipuler-des-chaînes-de-caractères" class="level1">
<h1>Manipuler des chaînes de caractères</h1>
<p>Le package <code>stringr</code> est dédié à la manipulation de chaînes de caractères. Nous aimerions séparer la colonne <em>espece</em> en deux colonnes :</p>
<ul>
<li>une colonne contenant le nom de l’espèce (<em>Adelie</em> par exemple)<br>
</li>
<li>une colonne contenant le nom latin de l’espèce (<em>Pygoscelis adeliae</em>)</li>
</ul>
<p>La fonction <code>str_detect()</code> permet de rechercher un motif dans une chaîne de caractères :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>stringr<span class="sc">::</span><span class="fu">str_detect</span>(<span class="at">string =</span> pingouins_tmp<span class="sc">$</span>espece, <span class="at">pattern =</span> <span class="st">"Adelie"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Utilisons la fonction <code>word()</code> pour extraire les mots en position 3 et 4 de la variable espèce. Cette fonction s’utilise de la manière suivante : <code>str_word(chaine, debut, fin)</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>pingouins_tmp <span class="ot">&lt;-</span> pingouins_tmp <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">nom_latin =</span> stringr<span class="sc">::</span><span class="fu">word</span>(<span class="at">string =</span> espece,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">start =</span> <span class="dv">3</span>, <span class="at">end =</span> <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Notre nouvelle variable <em>nom_latin</em> a bien été créée, mais elle contient des parenthèses. Pour les supprimer, nous utilisons la fonction <code>str_remove_all()</code> en combinaison avec une expression régulière (regex) : les parenthèses à supprimer sont placées entre crochets, eux-mêmes placés entre des guillemets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>pingouins_tmp <span class="ot">&lt;-</span> pingouins_tmp <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">nom_latin =</span> stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="at">string =</span> nom_latin,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">pattern =</span> <span class="st">"[()]"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Il ne nous reste plus qu’à modifier la variable <em>espece</em> afin de ne conserver que le premier mot, puis de modifier l’ordre des colonnes :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>pingouins_tmp <span class="ot">&lt;-</span> pingouins_tmp <span class="sc">%&gt;%</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">espece =</span> stringr<span class="sc">::</span><span class="fu">word</span>(<span class="at">string =</span> espece,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(espece, nom_latin, dplyr<span class="sc">::</span><span class="fu">everything</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Exportons maintenant nos données nettoyées à l’aide de la fonction <code>write_csv()</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(pingouins_tmp, <span class="st">"data/pingouins_propre.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Les expressions régulières
</div>
</div>
<div class="callout-body-container callout-body">
<p>Pour en savoir plus sur les expressions régulières, vous pouvez lire <a href="https://dridk.me/expression-reguliere.html">cet article</a>. Il existe souvent plusieurs façons d’arriver au même résultat. Pour le nom latin, nous aurions pu extraire la chaîne de caractères située entre les parenthèses :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>stringr<span class="sc">::</span><span class="fu">str_extract</span>(pingouins<span class="sc">$</span>Espece, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">().+?(?=</span><span class="sc">\\</span><span class="st">))"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pour extraire le nom de l’espèce, nous pouvons utiliser une expression régulière pour extraire les caractères précédant le premier espace vide :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>stringr<span class="sc">::</span><span class="fu">str_extract</span>(pingouins<span class="sc">$</span>Espece, <span class="st">"</span><span class="sc">\\</span><span class="st">w+"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="joindre-des-tableaux" class="level1">
<h1>Joindre des tableaux</h1>
<p>Le package <code>dplyr</code> propose plusieurs fonctions pour joindre deux tableaux. Les lignes des deux tableaux seront associées en fonction de <em>clés</em>, c’est-à-dire des colonnes communes.</p>
<p>Le schéma ci-dessous (tiré du livre <a href="https://r4ds.had.co.nz/relational-data.html">R for Data Science</a>) représente les différentes fonctions <code>..._join()</code> :</p>
<p><img src="img/join-venn.png" class="img-fluid" style="width:50.0%"></p>
<p><br></p>
<p>Pour bien comprendre ces différentes fonctions, nous allons créer deux sous-ensembles de données :</p>
<ul>
<li><code>d1</code> : lignes 1 à 3 du tableau, variable <em>longueur_bec_mm</em><br>
</li>
<li><code>d2</code> : lignes 2 à 4 du tableau, variable <em>hauteur_bec_mm</em></li>
</ul>
<p><br></p>
<p>Nous commençons par ajouter une colonne contenant les numéros de ligne, à l’aide de la fonction <code>rowid_to_column()</code> du package <code>tibble</code>. Par défaut, cette fonction ajoute la colonne d’index au début du tableau, et l’argument <code>var =</code> permet de choisir le nom de cette colonne. La fonction <code>slice()</code> permet de créer un sous-ensemble de lignes à l’aide de leurs positions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> pingouins_tmp <span class="sc">%&gt;%</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">"ind_num"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(ind_num, longueur_bec_mm) <span class="sc">%&gt;%</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> pingouins_tmp <span class="sc">%&gt;%</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">"ind_num"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(ind_num, hauteur_bec_mm) <span class="sc">%&gt;%</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<table class="table">
<tbody>
<tr class="odd">
<td><code>inner_join(d1, d2)</code></td>
<td><img src="img/inner_join.png" class="img-fluid" style="width:50.0%"></td>
</tr>
<tr class="even">
<td><code>full_join(d1, d2)</code></td>
<td><img src="img/full_join.png" class="img-fluid" style="width:50.0%"></td>
</tr>
<tr class="odd">
<td><code>left_join(d1, d2)</code></td>
<td><img src="img/left_join.png" class="img-fluid" style="width:50.0%"></td>
</tr>
<tr class="even">
<td><code>right_join(d1, d2)</code></td>
<td><img src="img/right_join.png" class="img-fluid" style="width:50.0%"></td>
</tr>
<tr class="odd">
<td><code>anti_join(d1, d2)</code></td>
<td><img src="img/anti_join_1.png" class="img-fluid" style="width:50.0%"></td>
</tr>
<tr class="even">
<td><code>anti_join(d2, d1)</code></td>
<td><img src="img/anti_join_2.png" class="img-fluid" style="width:50.0%"></td>
</tr>
</tbody>
</table>
<p><br></p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Les clés de jointure
</div>
</div>
<div class="callout-body-container callout-body">
<p>La colonne commune porte le même nom dans nos deux tableaux <code>d1</code> et <code>d2</code>. Si ce n’était pas le cas, nous devrions préciser la <em>clé</em> de jointure. Dans ce cas, la colonne de jointure du tableau résultant prendra le nom de cette colonne dans le premier tableau :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> d1 <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">numero_ind =</span> ind_num)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(d1, d2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"numero_ind"</span> <span class="ot">=</span> <span class="st">"ind_num"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p><br></p>
<div class="callout-important callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercice 3 - énoncé
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importer le fichier codes_pays.csv</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajouter les colonnes de ce tableau au tableau gapminder_tmp</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Placer les colonnes "iso_alpha" et "iso_num" apres la colonne "country"</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Exporter ce tableau au format csv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout-important callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercice 3 - solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importer le fichier codes_pays.csv</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>codes_pays <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"raw/codes_pays.csv"</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajouter les colonnes de ce tableau au tableau gapminder_tmp et deplacer les colonnes</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>gapminder_codes <span class="ot">&lt;-</span> gapminder_tmp <span class="sc">%&gt;%</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(codes_pays) <span class="sc">%&gt;%</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(continent, country, iso_alpha, iso_num, dplyr<span class="sc">::</span><span class="fu">everything</span>())</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Exporter ce tableau au format csv</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(gapminder_codes, <span class="st">"data/gapminder_codes.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="transformer-des-tableaux" class="level1">
<h1>Transformer des tableaux</h1>
<p>La suite de packages <code>tidyverse</code> se base sur le principe des <a href="https://www.jstatsoft.org/article/view/v059i10"><em>tidy data</em></a> :</p>
<ul>
<li>chaque variable est située dans sa propre colonne<br>
</li>
<li>chaque observation est située sur sa propre ligne<br>
</li>
<li>chaque valeur est située dans sa cellule</li>
</ul>
<p>Ces trois principes sont résumés dans la figure suivante, tirée de <a href="https://r4ds.had.co.nz/tidy-data.html">R for Data Science</a> :</p>
<p><img src="img/tidy-1.png" class="img-fluid" style="width:75.0%"></p>
<p><br></p>
<p>Le package <code>tidyr</code> proprose des fonctions permettant de transformer un tableau dans un format <em>tidy</em>. Nos données étant déjà dans ce format, nous allons créer un sous-ensemble de données pour les transformer dans un format <em>non-tidy</em> puis les transformer à nouveau dans un format <em>tidy</em>.</p>
<p>Ce sous-ensemble contient les dix premières lignes du tableau et les variables <em>espece</em> et <em>ratio_bec</em> (nous ajoutons également un index des lignes)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>d3 <span class="ot">&lt;-</span> pingouins_tmp <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">"ind_num"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(ind_num, espece, ile, longueur_bec_mm) <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Nos données sont dans ce que l’on appelle également un format <em>long</em>. Pour les transformer dans un format <em>non-tidy</em> ou encore format <em>large</em>, nous utilisons la fonction <code>pivot_wider()</code>.</p>
<p>Les arguments suivants doivent être précisés :</p>
<ul>
<li><code>names_from</code> : colonne qui servira à nommer les colonnes dans le tableau au format large<br>
</li>
<li><code>values_from</code> : colonne qui contient les valeurs qui nous intéressent</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">data =</span> d3,</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_from =</span> ind_num,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_from =</span> longueur_bec_mm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Un autre argument, <code>id_cols</code>, permet de préciser les colonnes qui permettent d’identifier chaque individu. Par défaut, il s’agit de toutes les colonnes autres que celles précisées dans <code>names_from</code> et <code>values_from</code>. Dans certains cas, il peut être nécessaire de déclarer explicitement ces colonnes d’identification.</p>
<p><br></p>
<p>Pour rendre les noms des colonnes plus facilement utilisables et supprimer les “`", nous ajoutons l’argument<code>names_prefix</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">data =</span> d3,</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_from =</span> ind_num,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_prefix =</span> <span class="st">"ind"</span>,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_from =</span> longueur_bec_mm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Assignons ce tableau transformé au format <em>large</em> dans un objet :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>d3_wide <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">data =</span> d3,</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">names_from =</span> ind_num,</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">names_prefix =</span> <span class="st">"ind"</span>,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">values_from =</span> longueur_bec_mm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>La fonction <code>pivot_longer()</code> va nous permettre de revenir dans un format <em>tidy</em> (<em>long</em>). Nous utilisons les arguments suivants :</p>
<ul>
<li><code>cols</code> : colonnes du format large à regrouper<br>
</li>
<li><code>names_to</code> : nom de la colonne dans laquelle seront regroupés les noms des colonnes indiqués dans <code>cols</code><br>
</li>
<li><code>names_prefix</code> : préfixe à supprimer<br>
</li>
<li><code>values_to</code> : nom de la colonne qui contiendra les valeurs</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">data =</span> d3_wide,</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(espece, ile),</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">names_to =</span> <span class="st">"ind_num"</span>,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">names_prefix =</span> <span class="st">"ind"</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values_to =</span> <span class="st">"longueur_bec_mm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Le format <em>tidy</em> facilite les analyses en permettant de filtrer les données, de les regrouper, …</p>
<p><br></p>
<div class="callout-important callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercice 4 - énoncé
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>A partir du tableau <code>gapminder_tmp</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrer les donnees pour les pays d'Europe</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># En utilisant la variable "life_exp", transformer le tableau au format large</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer ce tableau au format long</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout-important callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercice 4 - solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrer les donnees pour les pays d'Europe</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>europe <span class="ot">&lt;-</span> gapminder_tmp <span class="sc">%&gt;%</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">"Europe"</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="co"># En utilisant la variable "life_exp", transformer le tableau au format large</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>europe_wide <span class="ot">&lt;-</span> europe <span class="sc">%&gt;%</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(country, continent),</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">names_from =</span> year,</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">names_prefix =</span> <span class="st">"year"</span>,</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values_from =</span> life_exp)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer ce tableau au format long</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>europe_long <span class="ot">&lt;-</span> europe_wide <span class="sc">%&gt;%</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(country, continent),</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">names_to =</span> <span class="st">"year"</span>,</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">names_prefix =</span> <span class="st">"year"</span>,</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values_to =</span> <span class="st">"life_exp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="manipuler-des-facteurs" class="level1">
<h1>Manipuler des facteurs</h1>
<p>Le package <code>forcats</code> propose des fonctions permettant de manipuler des facteurs.</p>
<p>Commençons par transformer les variables qui ont un nombre limité de modalités en facteurs à l’aide de la fonction <code>fct()</code>. Par défaut, cette fonction crée des niveaux de facteur selon l’ordre d’apparition des modalités dans le tableau :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>pingouins_tmp <span class="ot">&lt;-</span> pingouins_tmp <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">espece =</span> forcats<span class="sc">::</span><span class="fu">fct</span>(espece),</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">nom_latin =</span> forcats<span class="sc">::</span><span class="fu">fct</span>(nom_latin),</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">ile =</span> forcats<span class="sc">::</span><span class="fu">fct</span>(ile))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>La fonction <code>fct_recode()</code> permet de recoder les niveaux d’un facteur :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>pingouins_tmp <span class="ot">&lt;-</span> pingouins_tmp <span class="sc">%&gt;%</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">espece =</span> forcats<span class="sc">::</span><span class="fu">fct_recode</span>(espece,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">"espece_Adelie"</span> <span class="ot">=</span> <span class="st">"Adelie"</span>,</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">"espece_Gentoo"</span> <span class="ot">=</span> <span class="st">"Gentoo"</span>,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">"espece_Chinstrap"</span> <span class="ot">=</span> <span class="st">"Chinstrap"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>La fonction <code>fct_relevel()</code> permet d’ordonner manuellement les niveaux d’un facteur :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>pingouins_tmp <span class="ot">&lt;-</span> pingouins_tmp <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">ile =</span> forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(ile,</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"Dream"</span>, <span class="st">"Biscoe"</span>, <span class="st">"Torgersen"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>La fonction <code>fct_rev()</code> permet d’inverser l’ordre des niveaux d’un facteur :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>pingouins_tmp <span class="ot">&lt;-</span> pingouins_tmp <span class="sc">%&gt;%</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">ile =</span> forcats<span class="sc">::</span><span class="fu">fct_rev</span>(ile))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>La fonction <code>fct_reorder()</code> permet de trier les modalités d’un facteur selon une autre variable. Nous pouvons par exemple trier les modalités de la variable <em>espece</em> en fonction de la médiane de la variable *hauteur_bec_mm” :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>pingouins_tmp <span class="ot">&lt;-</span> pingouins_tmp <span class="sc">%&gt;%</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">espece =</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(espece, hauteur_bec_mm, median, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>La fonction <code>fct_infreq()</code> permet de trier les modalités d’un facteur selon les effectifs (par défaut par ordre décroissant) :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>pingouins_tmp <span class="ot">&lt;-</span> pingouins_tmp <span class="sc">%&gt;%</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">espece =</span> forcats<span class="sc">::</span><span class="fu">fct_infreq</span>(espece))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Intérêt de la gestion des niveaux d’un facteur
</div>
</div>
<div class="callout-body-container callout-body">
<p>Les fonctions du package <code>forcats</code> permettent de gérer dynamiquement les niveaux d’un facteur, en fonction de ce que l’on recherche (trier par ordre d’apparition, par effectifs, …). Ces fonctions sont particulièrement intéressantes lorsque l’on souhaite représenter graphiquement des variables catégorielles.</p>
</div>
</div>
<p><br></p>
<div class="callout-important callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-20-contents" aria-controls="callout-20" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercice 5 - énoncé
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-20" class="callout-20-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>A partir du tableau <code>gapminder_tmp</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraire les donnees pour l'annee 2002</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer les variables "continent" et "country" en facteurs</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Trier les niveaux la variable "continent" par effectif</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Trier les niveaux de la variable "country" par population</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout-important callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-21-contents" aria-controls="callout-21" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercice 5 - solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-21" class="callout-21-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraire les donnees pour l'annee 2002</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>year2002 <span class="ot">&lt;-</span> gapminder_tmp <span class="sc">%&gt;%</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2002</span>)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformer les variables "continent" et "country" en facteurs</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>year2002 <span class="ot">&lt;-</span> year2002 <span class="sc">%&gt;%</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">continent =</span> forcats<span class="sc">::</span><span class="fu">fct</span>(continent),</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">country =</span> forcats<span class="sc">::</span><span class="fu">fct</span>(country))</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Trier les niveaux la variable "continent" par effectif</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>year2002 <span class="ot">&lt;-</span> year2002 <span class="sc">%&gt;%</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">continent =</span> forcats<span class="sc">::</span><span class="fu">fct_infreq</span>(continent))</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Trier les niveaux de la variable "country" par population decroissante</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>year2002 <span class="ot">&lt;-</span> year2002 <span class="sc">%&gt;%</span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">country =</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(country, <span class="sc">-</span>pop))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>